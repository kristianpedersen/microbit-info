(this["webpackJsonpmicrobit-info"]=this["webpackJsonpmicrobit-info"]||[]).push([[0],{28:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n(0),a=n.n(c),i=n(17),s=n.n(i),o=n(4),u=n(5),f=(n(28),n(2)),b=n(3);function l(){var e=Object(f.a)(["\n\tborder: 1px solid black;\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n"]);return l=function(){return e},e}b.a.canvas(l());var j,d=n(6),m=n(21),O=n(7),p=n.n(O),g=n(13),h="";function v(e){var t=e.formRef,n=e.numberOfReceivedMessages,c=e.setKeys,a=e.setMessages,i=e.setMicrobit;function s(){return(s=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.usb.requestDevice({filters:[{vendorId:3368}]});case 2:return j=e.sent,e.next=5,j.open();case 5:return e.next=7,j.selectConfiguration(1);case 7:return e.next=9,j.claimInterface(2);case 9:i(j),f();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(){return(o=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.close();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return e.split("").reduce((function(e,t,n,r){if(":"===t){for(var c=[],a=n;a>=0;a--){var i=r[a];if("0123456789".split("").includes(i)&&a<n-1)break;c.unshift(i)}for(var s="",o=n+1;o<r.length;o++){var u=r[o];if(!"0123456789-".split("").includes(u))break;s+=u}c=c.join("").slice(0,-1),e.push("".concat(c,": ").concat(s))}return e}),[])}function f(){return b.apply(this,arguments)}function b(){return(b=Object(g.a)(p.a.mark((function e(){var r,i,s,o,b,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.current++,e.next=3,j.transferIn(4,64);case 3:if(r=e.sent,i=new TextDecoder,(s=i.decode(r.data).trim()).length>0)h+=s;else{if((h=u(h)).length>0){o=Object(m.a)(h);try{for(l=function(){var e=b.value,r=String(e).split(":")[0].trim();a((function(n){var r=new Date,c=r.getHours(),a=String(r.getMinutes()).padStart(2,"0"),i=String(r.getSeconds()).padStart(2,"0"),s="".concat(c,":").concat(a,":").concat(i);if(void 0===n)return[{time:s,msg:e}];if(""!==e){var o=Object(d.a)(t.current.querySelectorAll("label")),u=e.split(":")[0],f=o.filter((function(e){return e.id===u}))[0];if(void 0!==f)if(f.querySelector("input").checked)return[].concat(Object(d.a)(n.slice(-10)),[{time:s,msg:e}])}return n})),n.current>100&&c((function(e){return Object(d.a)(new Set([].concat(Object(d.a)(e),[r])))}))},o.s();!(b=o.n()).done;)l()}catch(O){o.e(O)}finally{o.f()}}h=""}f();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){return s.apply(this,arguments)},children:"Connect micro:bit"}),Object(r.jsx)("button",{onClick:function(){return o.apply(this,arguments)},children:"Disconnect"}),Object(r.jsx)("button",{onClick:function(){c([])},children:"Clear keys"})," "]})}var x=n(10),y=n.n(x);function k(e,t,n){return e<t?t:e>n?n:e}function R(){var e=Object(f.a)(["\n\tbackground-color: white;\n\tborder: 1px solid #333;\n\tpadding: 1rem;\n"]);return R=function(){return e},e}function w(e){var t=e.messages,n=e.ranges,a=Object(c.useRef)(null),i=Object(c.useRef)(null),s=Object(c.useRef)(0),o=Object(c.useState)([]),f=Object(u.a)(o,2),b=f[0],l=f[1],j=Object(c.useState)(),d=Object(u.a)(j,2),m=d[0],O=d[1];return Object(c.useEffect)((function(){y.a.enable((function(e){e?(a.current.innerText="Web MIDI works best in Google Chrome",i.innerText=e):0===y.a.outputs.length?a.current.innerHTML="You need to set up a virtual MIDI port: <a href='https://help.ableton.com/hc/en-us/articles/209774225-How-to-setup-a-virtual-MIDI-bus'>Instructions</a>":l((function(){return y.a.outputs}))}))}),[]),Object(c.useEffect)((function(){if(void 0!==m&&0!==t.length){var e=t[0].msg.split(":")[1],r=function(e,t,n,r,c){var a=(e-t)*(c-r)/(n-t)+r;return arguments.length>5&&void 0!==arguments[5]&&arguments[5]?k(a,r,c):a}(e,n["min-from"]||0,n["max-from"]||0,0,127,!0);isNaN(e)||isNaN(r)||(s.current+=.25*(r-s.current),m.sendControlChange(0,k(s.current,0,127)))}}),[t,n,m]),Object(c.useEffect)((function(){void 0!==m&&(m.playNote("C5"),setTimeout((function(){m.stopNote("C5")}),100))}),[m]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h1",{ref:a,children:"MIDI device"}),Object(r.jsxs)("form",{children:[b.length>0&&b.map((function(e){var t=e.name.replaceAll(" ","-");return Object(r.jsxs)(C,{htmlFor:t,onClick:function(){return t=e.name,void O(y.a.getOutputByName(t));var t},children:[Object(r.jsx)("input",{id:t,name:"midi-device",type:"radio"}),e.name]})})),Object(r.jsx)("p",{ref:i})]})]})}var C=b.a.label(R()),M=n(33);function S(){var e=Object(f.a)(["\n\twidth: 20%;\n\theight: 90vh;\n\tmargin-top: 1rem;\n"]);return S=function(){return e},e}function I(e){e.formRef,e.keys;var t=e.messages,n=e.microbit,c=e.numberOfReceivedMessages;return Object(r.jsxs)("div",{children:[void 0===n?Object(r.jsx)("h1",{children:"Click connect button"}):Object(r.jsx)("h1",{children:n.productName}),t.map((function(e){return c.current>100?Object(r.jsx)("p",{children:"".concat(e.time," / ").concat(e.msg)},Object(M.a)()):Object(r.jsx)("p",{children:"loading ..."})}))]})}b.a.textarea(S());function N(e){var t=e.formRef,n=e.numberOfReceivedMessages,a=e.keys,i=e.setKeys,s=e.ranges,f=(e.setRanges,Object(c.useRef)()),b=Object(c.useState)(),l=Object(u.a)(b,2),j=l[0],d=l[1],m=Object(c.useState)([]),O=Object(u.a)(m,2),p=O[0],g={formRef:t,logWindow:f,numberOfReceivedMessages:n,keys:a,setKeys:i,messages:p,setMessages:O[1],microbit:j,setMicrobit:d};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(v,Object(o.a)({},g)),Object(r.jsx)(w,Object(o.a)({},{messages:p,ranges:s})),Object(r.jsx)(I,Object(o.a)({},g))]})}var D=n(11);function F(){var e=Object(f.a)(["\n\tbackground-color: hsl(30, 100%, 90%);\n\tmargin-left: 1rem;\n\tmargin-right: 0;\n"]);return F=function(){return e},e}function T(){var e=Object(f.a)(["\n\tbackground-color: hsl(210, 100%, 90%);\n\tpadding-right: 0;\n"]);return T=function(){return e},e}function E(){var e=Object(f.a)(["\n\tpadding: 1rem;\n\tpadding-left: 0;\n"]);return E=function(){return e},e}function K(e){var t=e.formRef,n=e.keys,c=(e.ranges,e.setRanges);function a(e){c((function(t){return Object(o.a)(Object(o.a)({},t),{},Object(D.a)({},e.target.id,Number(e.target.value)))}))}return Object(r.jsx)(q,{ref:t,children:Object(d.a)(n).map((function(e){var t=Object(M.a)();return Object(r.jsxs)(H,{htmlFor:t,id:e,name:t,style:{padding:"1rem",border:"1px solid",display:"inline-block"},children:[Object(r.jsx)("input",{type:"checkbox",name:t,id:t,defaultChecked:!0}),e,Object(r.jsxs)(A,{children:["From min",Object(r.jsx)("input",{type:"number",name:"min-from",id:"min-from",onChange:a}),"From max",Object(r.jsx)("input",{type:"number",name:"max-from",id:"max-from",onChange:a})]})]})}))})}var q=b.a.form(E()),H=b.a.label(T()),A=b.a.span(F());function B(){var e=Object(c.useRef)(null),t=Object(c.useState)({}),n=Object(u.a)(t,2),a=n[0],i=n[1],s=Object(c.useState)([]),f=Object(u.a)(s,2),b=f[0],l=f[1],j=Object(c.useRef)(0);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(K,Object(o.a)({},{formRef:e,keys:b,ranges:a,setRanges:i})),Object(r.jsx)(N,Object(o.a)({},{formRef:e,numberOfReceivedMessages:j,keys:b,setKeys:l,ranges:a,setRanges:i}))]})}s.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(B,{})}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.815bafc5.chunk.js.map